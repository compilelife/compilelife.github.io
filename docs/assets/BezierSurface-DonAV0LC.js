import{S as K}from"./svg.draggable-CvVuDuZ7.js";import{i as A,_ as Q,u as W,k as R,r as G,o as X,w as Z,a as _,b as U,c as j,d as f,e as l,f as I,t as x,g as y,h as ee,E as te,p as se,j as oe}from"./index-B8A6QkBu.js";class k{constructor(e,t){this.x=e,this.y=t}}class P{constructor(e,t){this.u=e,this.v=t}}class J{constructor(e){this.uvPoints=e,this.screenPoints=new Array(4)}}class ne{constructor(e,t){this.drawFn=e,this.param=t}run(){return this.drawFn(this.param)}}class ie{constructor(e,t){this.setAnimInfo=e,this.g=t,this.reset()}reset(){this.frames=[],this.n=0}seek(e){this.n=e,this.step()}step(){this.g.clear();const e=this.frames[this.n];if(e){const t=e.run();this.setAnimInfo(A.global.t("bezier.animateInfoTitle",[this.n+1,this.frames.length]),t),this.n+=1}}addFrame(e,t){this.frames.push(new ne(t,e))}play(){this.seek(0);const e=4e3/this.frames.length,t=setInterval(()=>{if(this.n>=this.frames.length){clearInterval(t);return}this.step()},e)}plainDraw(){this.seek(this.frames.length-1),this.setAnimInfo("","")}}function N(c){let e=1;for(let t=2;t<=c;t++)e*=t;return e}function O(c,e){return N(c)/(N(e)*N(c-e))}function D(c,e){return c===0&&e===0?1:Math.pow(c,e)}class le{constructor(e){e?this.points=e.map(t=>t.map(s=>new k(s[0],s[1]))):this.points=Array(3).fill().map(()=>Array(3).fill().map(()=>new k(0,0)))}addRow(){const e=this.points[this.points.length-1].map(t=>new k(t.x,t.y+20));this.points.push(e)}addCol(){for(let e=0;e<this.points.length;e++){const t=this.points[e],s=t[t.length-1];t.push(new k(s.x+20,s.y))}}at(e,t){return this.points[e][t]}}function re(c,e){const t=c.length-1,s=c[0].length-1,o=e.u,u=e.v;let r=new k(0,0);for(let a=0;a<=t;a++){const d=O(t,a)*D(u,a)*D(1-u,t-a);for(let v=0;v<=s;v++){const w=O(s,v)*D(o,v)*D(1-o,s-v);r.x+=c[a][v].x*d*w,r.y+=c[a][v].y*d*w}}return r}let T=class{constructor(e,t={firstDivide,divide,showGrid,count},s,o=null){if(this.svg=K(e),this.curveG=this.svg.group(),this.controlG=this.svg.group(),this.anim=new ie(s,this.curveG),this.ps=new le(o),!o)for(let u=0;u<this.ps.points.length;u++){const r=this.ps.points[u];for(let a=0;a<r.length;a++)r[a].x=a*150,r[a].y=u*150}this.recreateSvgControlPoints(),this.param=t,this.redraw()}addRow(){this.ps.addRow(),this.recreateSvgControlPoints(),this.redraw()}addCol(){this.ps.addCol(),this.recreateSvgControlPoints(),this.redraw()}static load(e){return JSON.parse(e)}save(){return JSON.stringify(this.ps.points.map(t=>t.map(s=>[Math.floor(s.x),Math.floor(s.y)])))}recreateSvgControlPoints(){this.controlG.clear();for(let e=0;e<this.ps.points.length;e++){const t=this.ps.points[e];for(let s=0;s<t.length;s++){const o=t[s];o.i=e,o.j=s;const u=this.controlG.circle(10).fill("#337ecc").center(o.x,o.y);u.draggable().on("dragmove",r=>{o.x=r.detail.box.cx,o.y=r.detail.box.cy,this.redraw()}).on("mouseenter",()=>{u.fill("#f89898"),u.coordText=this.curveG.text(`[${o.i}, ${o.j}](${o.x.toFixed(0)}, ${o.y.toFixed(0)})`).move(o.x-10,o.y+20)}).on("mouseleave",()=>{var r;u.fill("#337ecc"),(r=u.coordText)==null||r.remove()})}}}meshDivide(e,t=2,s=t){let o=[];for(const u of e){const r=u.uvPoints[0].u,a=u.uvPoints[1].u,d=u.uvPoints[0].v,v=u.uvPoints[3].v,w=(a-r)/t,g=(v-d)/s;for(let p=0;p<s;p++)for(let m=0;m<t;m++)o.push(new J([new P(r+w*m,d+g*p),new P(r+w*m+w,d+g*p),new P(r+w*m+w,d+g*p+g),new P(r+w*m,d+g*p+g)]))}return o}bezierSurface(e){const{firstDivide:t,divide:s,showGrid:o,count:u}=this.param;let r=new Set([0,1]),a=new Set([0,1]);const d=m=>Math.round(m*1e3),v=m=>{for(const i of m)for(let n=0;n<4;n++)i.screenPoints[n]=re(e,i.uvPoints[n]);return m},w=m=>{m.forEach(i=>{i.uvPoints.forEach(n=>{r.add(d(n.u)),a.add(d(n.v))})})},g=({meshes:m})=>{for(const i of m)(o.value||a.has(d(i.uvPoints[0].v)))&&this.curveG.line(i.screenPoints[0].x,i.screenPoints[0].y,i.screenPoints[1].x,i.screenPoints[1].y).stroke({color:"black"}),(o.value||r.has(d(i.uvPoints[1].u)))&&this.curveG.line(i.screenPoints[1].x,i.screenPoints[1].y,i.screenPoints[2].x,i.screenPoints[2].y).stroke({color:"black"}),(o.value||a.has(d(i.uvPoints[2].v)))&&this.curveG.line(i.screenPoints[2].x,i.screenPoints[2].y,i.screenPoints[3].x,i.screenPoints[3].y).stroke({color:"black"}),(o.value||r.has(d(i.uvPoints[3].u)))&&this.curveG.line(i.screenPoints[3].x,i.screenPoints[3].y,i.screenPoints[0].x,i.screenPoints[0].y).stroke({color:"black"})};this.anim.reset();let p=[new J([new P(0,0),new P(1,0),new P(1,1),new P(0,1)])];this.anim.addFrame({meshes:v(p)},g),p=this.meshDivide(p,t.row,t.col),w(p),this.anim.addFrame({meshes:v(p)},g);for(let m=1;m<u.value;m++)p=this.meshDivide(p,s.row,s.col),this.anim.addFrame({meshes:v(p)},g)}redraw(e=!1){this.bezierSurface(this.ps.points),e?this.anim.play():this.anim.plainDraw()}};const ae=c=>(se("data-v-472248f6"),c=c(),oe(),c),ce={class:"text-large font-600 mr-3"},ue={class:"usage"},de=ae(()=>I("svg",{id:"canvas",xmlns:"http://www.w3.org/2000/svg",version:"1.1",viewBox:"0 0 800 600",preserveAspectRatio:"xMidYMid meet"},null,-1)),he={__name:"BezierSurface",setup(c){const e=W(),t=R({row:3,col:3}),s=R({row:3,col:3}),o=G(!0),u=G(""),r=G(""),a=G(1);let d=null,v=null;new URLSearchParams(location.search).forEach((n,h)=>{if(h==="firstDivide"){const{row:V,col:z}=JSON.parse(n);t.row=V,t.col=z}else if(h==="divide"){const{row:V,col:z}=JSON.parse(n);s.row=V,s.col=z}else h==="showGrid"?o.value=n=="true":h==="points"?v=T.load(n):h==="count"&&(a.value=parseInt(n))}),X(()=>{d=new T("#canvas",{firstDivide:t,divide:s,showGrid:o,count:a},(n,h)=>{u.value=n,r.value=h},v)}),Z([t,s,a,o],()=>{d.redraw()});const w=()=>{d.redraw(!0)},g=()=>{const n=d.save(),h=`${window.location.origin}/beziersf?firstDivide=${JSON.stringify(t)}&divide=${JSON.stringify(s)}&showGrid=${o.value}&points=${n}&count=${a.value}`;navigator.clipboard.writeText(h),te({title:A.global.t("bezier.shareTitle"),message:A.global.t("bezier.shareDesc")})},p=()=>{d.addRow()},m=()=>{d.addCol()},i=()=>{e.push("/")};return(n,h)=>{const V=_("el-page-header"),z=_("el-header"),C=_("el-button"),S=_("el-form-item"),$=_("el-input-number"),F=_("el-text"),B=_("el-space"),E=_("el-checkbox"),L=_("el-form"),Y=_("el-aside"),q=_("el-alert"),H=_("el-main"),M=_("el-container");return U(),j(M,{style:{height:"100%"}},{default:f(()=>[l(z,null,{default:f(()=>[l(V,{onBack:i,style:{"padding-top":"10px"}},{content:f(()=>[I("span",ce,x(n.$t("beziersf.title")),1)]),_:1})]),_:1}),l(M,{style:{height:"calc(100% - 40px)"}},{default:f(()=>[l(Y,{width:"320px"},{default:f(()=>[l(L,{"label-position":"left","label-width":"auto"},{default:f(()=>[l(S,{label:n.$t("beziersf.grid")},{default:f(()=>[l(C,{onClick:p},{default:f(()=>[y(x(n.$t("beziersf.addRow")),1)]),_:1}),l(C,{onClick:m},{default:f(()=>[y(x(n.$t("beziersf.addCol")),1)]),_:1})]),_:1},8,["label"]),l(S,{label:n.$t("beziersf.tessellation")},{default:f(()=>[l($,{modelValue:a.value,"onUpdate:modelValue":h[0]||(h[0]=b=>a.value=b),min:1,max:4,"controls-position":"right"},null,8,["modelValue"])]),_:1},8,["label"]),l(S,{label:n.$t("beziersf.firstDivide")},{default:f(()=>[l(B,null,{default:f(()=>[l($,{modelValue:t.row,"onUpdate:modelValue":h[1]||(h[1]=b=>t.row=b),min:2,max:5,"controls-position":"right"},null,8,["modelValue"]),l(F,null,{default:f(()=>[y("x")]),_:1}),l($,{modelValue:t.col,"onUpdate:modelValue":h[2]||(h[2]=b=>t.col=b),min:2,max:5,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1},8,["label"]),l(S,{label:n.$t("beziersf.divide")},{default:f(()=>[l(B,null,{default:f(()=>[l($,{modelValue:s.row,"onUpdate:modelValue":h[3]||(h[3]=b=>s.row=b),min:2,max:5,"controls-position":"right"},null,8,["modelValue"]),l(F,null,{default:f(()=>[y("x")]),_:1}),l($,{modelValue:s.col,"onUpdate:modelValue":h[4]||(h[4]=b=>s.col=b),min:2,max:5,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1},8,["label"]),l(S,{label:n.$t("beziersf.showGrid")},{default:f(()=>[l(E,{modelValue:o.value,"onUpdate:modelValue":h[5]||(h[5]=b=>o.value=b)},null,8,["modelValue"])]),_:1},8,["label"]),l(S,null,{default:f(()=>[l(C,{type:"primary",onClick:w},{default:f(()=>[y(x(n.$t("bezier.playAnim")),1)]),_:1}),l(C,{onClick:g},{default:f(()=>[y(x(n.$t("bezier.share")),1)]),_:1})]),_:1})]),_:1}),I("p",ue,[l(F,null,{default:f(()=>[I("strong",null,x(n.$t("bezier.usage")),1),y(x(n.$t("beziersf.usageDetail")),1)]),_:1})])]),_:1}),l(H,null,{default:f(()=>[u.value!==""?(U(),j(q,{key:0,class:"animateinfo",title:u.value,description:r.value,type:"success",closable:!1},null,8,["title","description"])):ee("",!0),de]),_:1})]),_:1})]),_:1})}}},ve=Q(he,[["__scopeId","data-v-472248f6"]]);export{ve as default};
