import{S as J}from"./svg.draggable-CvVuDuZ7.js";import{i as $,_ as O,u as Y,r as g,a as j,o as X,w as H,b as m,c as y,d as x,e as h,f as c,g as z,t as _,h as P,j as K,E as Q,p as W,k as Z}from"./index-B7aZGolE.js";class C{constructor(e,s){this.x=e,this.y=s}}function D(r){const e=[];for(let s=0;s<r.length;s++)e.push(new C(r[s].x,r[s].y));return e}class ee{constructor(e,s){this.drawFn=e,this.param=s}run(){return this.drawFn(this.param)}}class te{constructor(e,s){this.setAnimInfo=e,this.g=s,this.reset()}reset(){this.frames=[],this.n=0}seek(e){this.n=e,this.step()}step(){this.g.clear();const e=this.frames[this.n];if(e){const s=e.run();this.setAnimInfo($.global.t("bezier.animateInfoTitle",[this.n+1,this.frames.length]),s),this.n+=1}}addFrame(e,s){this.frames.push(new ee(s,e))}play(){this.seek(0);const e=4e3/this.frames.length,s=setInterval(()=>{if(this.n>=this.frames.length){clearInterval(s);return}this.step()},e)}plainDraw(){this.seek(this.frames.length-1),this.setAnimInfo("","")}}function k(r){let e=1;for(let s=2;s<=r;s++)e*=s;return e}function se(r,e){return k(r)/(k(e)*k(r-e))}function S(r,e){return r===0&&e===0?1:Math.pow(r,e)}class A{constructor(e,s={algorithm,iters,tstep},t,i=[]){if(this.svg=J(e),this.curveG=this.svg.group(),this.anim=new te(t,this.curveG),this.points=[],i.length>0)for(const o of i)this.addControlPoint(o[0],o[1]);else this.addControlPoint(100,100),this.addControlPoint(250,50),this.addControlPoint(400,100);this.param=s,this.redraw(),this.svg.on("dblclick",o=>{const a=this.svg.point(o.pageX,o.pageY);this.addControlPoint(a.x,a.y),this.redraw()})}static load(e){return JSON.parse(decodeURIComponent(e))}save(){return encodeURIComponent(JSON.stringify(this.points.map(e=>[Math.floor(e.x),Math.floor(e.y)])))}addControlPoint(e,s){const t=new C(e,s);this.points.push(t);const i=this.svg.circle(10).fill("#337ecc").center(t.x,t.y);i.draggable().on("dragmove",o=>{t.x=o.detail.box.cx,t.y=o.detail.box.cy,this.redraw()}).on("mouseenter",()=>{i.fill("#f89898"),i.coordText=this.curveG.text(`(${t.x.toFixed(0)}, ${t.y.toFixed(0)})`).move(t.x-10,t.y+20)}).on("mouseleave",()=>{var o;i.fill("#337ecc"),(o=i.coordText)==null||o.remove()})}drawCurve(e,s){for(let t=0;t<e.length;t++){const i=`P${t+1}`;this.curveG.text(i).move(e[t].x-10,e[t].y-30)}this.drawLines(s,{color:"black"})}drawLines(e,s){for(let t=1;t<e.length;t++){let i=e[t-1],o=e[t];this.curveG.line(i.x,i.y,o.x,o.y).stroke(s)}}bezierByFormula(e,s){this.anim.reset();const t=[],i=e.length-1;let o=0;function a(n){let u=new C(0,0);for(let l=0;l<=i;l++){const f=se(i,l)*S(n,l)*S(1-n,i-l);u.x+=e[l].x*f,u.y+=e[l].y*f}return u}for(;o<=1;)t.push(a(o)),this.anim.addFrame({t:o,curvePoints:D(t)},n=>(this.drawCurve(e,n.curvePoints),`t = ${n.t.toFixed(2)}`)),o+=s;return Math.abs(o-s-1)>.001&&(o=1,t.push(a(o)),this.anim.addFrame({t:o,curvePoints:D(t)},n=>(this.drawCurve(e,n.curvePoints),`t = ${n.t.toFixed(2)}`))),t}doBezierDivide(e){const s=e.length-1,t=[],i=[],o=[];for(let n=0;n<=s;n++)o.push(new Array(s+1));function a(n,u){let l=o[n][u];if(l)return l;if(l=new C(0,0),u===0)l=e[n];else{const f=a(n,u-1),b=a(n+1,u-1);l.x=(f.x+b.x)/2,l.y=(f.y+b.y)/2}return o[n][u]=l,l}for(let n=0;n<=s;n++){const u=n;t.push(a(0,u))}for(let n=0;n<=s;n++){const u=s-n;i.push(a(n,u))}return[t,i]}bezierByDivide(e,s=1){this.anim.reset();let t=[e];function i(){const o=[t[0][0]];for(let a=0;a<t.length;a+=2)o.push(t[a+1][0]);return o.push(t[t.length-1][t[t.length-1].length-1]),o}for(let o=0;o<s;o++){let a=[];for(const n of t)a=a.concat(this.doBezierDivide(n));t=a,this.anim.addFrame({i:o,curvePoints:i(),controlPoints:t.flat()},n=>(this.drawCurve(e,n.curvePoints),this.drawLines(n.controlPoints,{color:"gray",dasharray:[3,3]}),$.global.t("bezier.curIters",[n.i+1])))}return i()}redraw(e=!1){this.param.algorithm.value==="formula"?this.bezierByFormula(this.points,this.param.tstep.value):this.bezierByDivide(this.points,this.param.iters.value),e?this.anim.play():this.anim.plainDraw()}}const oe=r=>(W("data-v-8e71b5a0"),r=r(),Z(),r),ne={class:"text-large font-600 mr-3"},ie={class:"usage"},le=oe(()=>z("svg",{id:"canvas",xmlns:"http://www.w3.org/2000/svg",version:"1.1",viewBox:"0 0 800 600",preserveAspectRatio:"xMidYMid meet"},null,-1)),ae={__name:"Bezier",setup(r){const e=Y(),s=g("formula"),t=g(2),i=g(.1),o=g(""),a=g("");let n=null,u=[];const l=j().query;l.algorithm&&(s.value=l.algorithm),l.tstep&&(i.value=parseFloat(l.tstep)),l.iters&&(t.value=parseInt(l.iters)),l.points&&(u=A.load(l.points)),X(()=>{n=new A("#canvas",{algorithm:s,iters:t,tstep:i},(d,p)=>{o.value=d,a.value=p},u)}),H([s,t,i],()=>{n.redraw()});const f=()=>{n.redraw(!0)},b=()=>{const d=n.save(),p=`${window.location.origin}/#/bezier?algorithm=${s.value}&tstep=${i.value}&iters=${t.value}&points=${d}`;navigator.clipboard.writeText(p),Q({title:$.global.t("bezier.shareTitle"),message:$.global.t("bezier.shareDesc")})},N=()=>{e.push("/")};return(d,p)=>{const M=m("el-page-header"),G=m("el-header"),I=m("el-option"),T=m("el-select"),w=m("el-form-item"),B=m("el-input-number"),F=m("el-button"),R=m("el-form"),U=m("el-text"),L=m("el-aside"),q=m("el-alert"),E=m("el-main"),V=m("el-container");return y(),x(V,{style:{height:"100%"}},{default:h(()=>[c(G,null,{default:h(()=>[c(M,{onBack:N,style:{"padding-top":"10px"}},{content:h(()=>[z("span",ne,_(d.$t("bezier.title")),1)]),_:1})]),_:1}),c(V,{style:{height:"calc(100% - 40px)"}},{default:h(()=>[c(L,{width:"240px"},{default:h(()=>[c(R,{"label-position":"left","label-width":"auto"},{default:h(()=>[c(w,{label:d.$t("bezier.algorithm")},{default:h(()=>[c(T,{modelValue:s.value,"onUpdate:modelValue":p[0]||(p[0]=v=>s.value=v),style:{width:"150px"}},{default:h(()=>[c(I,{label:d.$t("bezier.byFormula"),value:"formula"},null,8,["label"]),c(I,{label:d.$t("bezier.byDeC"),value:"DeC"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["label"]),s.value=="formula"?(y(),x(w,{key:0,label:d.$t("bezier.tStep")},{default:h(()=>[c(B,{modelValue:i.value,"onUpdate:modelValue":p[1]||(p[1]=v=>i.value=v),min:.01,max:.5,step:.01,precision:2},null,8,["modelValue"])]),_:1},8,["label"])):(y(),x(w,{key:1,label:d.$t("bezier.iterNum")},{default:h(()=>[c(B,{modelValue:t.value,"onUpdate:modelValue":p[2]||(p[2]=v=>t.value=v),min:1,max:10},null,8,["modelValue"])]),_:1},8,["label"])),c(w,null,{default:h(()=>[c(F,{type:"primary",onClick:f},{default:h(()=>[P(_(d.$t("bezier.playAnim")),1)]),_:1}),c(F,{onClick:b},{default:h(()=>[P(_(d.$t("bezier.share")),1)]),_:1})]),_:1})]),_:1}),z("p",ie,[c(U,null,{default:h(()=>[z("strong",null,_(d.$t("bezier.usage")),1),P(_(d.$t("bezier.usageDetail")),1)]),_:1})])]),_:1}),c(E,null,{default:h(()=>[o.value!==""?(y(),x(q,{key:0,class:"animateinfo",title:o.value,description:a.value,type:"success",closable:!1},null,8,["title","description"])):K("",!0),le]),_:1})]),_:1})]),_:1})}}},ce=O(ae,[["__scopeId","data-v-8e71b5a0"]]);export{ce as default};
