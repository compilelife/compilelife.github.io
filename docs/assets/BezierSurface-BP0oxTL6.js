import{S as Q}from"./svg.draggable-CvVuDuZ7.js";import{i as N,_ as W,u as X,l as M,r as C,a as Z,o as ee,w as te,b as _,c as R,d as j,e as h,f as i,g as D,t as y,h as S,j as se,E as oe,p as ne,k as ie}from"./index-CSTyaV5Y.js";class k{constructor(e,t){this.x=e,this.y=t}}class P{constructor(e,t){this.u=e,this.v=t}}class U{constructor(e){this.uvPoints=e,this.screenPoints=new Array(4)}}class le{constructor(e,t){this.drawFn=e,this.param=t}run(){return this.drawFn(this.param)}}class re{constructor(e,t){this.setAnimInfo=e,this.g=t,this.reset()}reset(){this.frames=[],this.n=0}seek(e){this.n=e,this.step()}step(){this.g.clear();const e=this.frames[this.n];if(e){const t=e.run();this.setAnimInfo(N.global.t("bezier.animateInfoTitle",[this.n+1,this.frames.length]),t),this.n+=1}}addFrame(e,t){this.frames.push(new le(t,e))}play(){this.seek(0);const e=4e3/this.frames.length,t=setInterval(()=>{if(this.n>=this.frames.length){clearInterval(t);return}this.step()},e)}plainDraw(){this.seek(this.frames.length-1),this.setAnimInfo("","")}}function F(a){let e=1;for(let t=2;t<=a;t++)e*=t;return e}function J(a,e){return F(a)/(F(e)*F(a-e))}function G(a,e){return a===0&&e===0?1:Math.pow(a,e)}class ae{constructor(e){e?this.points=e.map(t=>t.map(s=>new k(s[0],s[1]))):this.points=Array(3).fill().map(()=>Array(3).fill().map(()=>new k(0,0)))}addRow(){const e=this.points[this.points.length-1].map(t=>new k(t.x,t.y+20));this.points.push(e)}addCol(){for(let e=0;e<this.points.length;e++){const t=this.points[e],s=t[t.length-1];t.push(new k(s.x+20,s.y))}}at(e,t){return this.points[e][t]}}function ce(a,e){const t=a.length-1,s=a[0].length-1,o=e.u,c=e.v;let l=new k(0,0);for(let r=0;r<=t;r++){const u=J(t,r)*G(c,r)*G(1-c,t-r);for(let w=0;w<=s;w++){const d=J(s,w)*G(o,w)*G(1-o,s-w);l.x+=a[r][w].x*u*d,l.y+=a[r][w].y*u*d}}return l}let O=class{constructor(e,t={firstDivide,divide,showGrid,count},s,o=null){if(this.svg=Q(e),this.curveG=this.svg.group(),this.controlG=this.svg.group(),this.anim=new re(s,this.curveG),this.ps=new ae(o),!o)for(let c=0;c<this.ps.points.length;c++){const l=this.ps.points[c];for(let r=0;r<l.length;r++)l[r].x=r*150,l[r].y=c*150}this.recreateSvgControlPoints(),this.param=t,this.redraw()}addRow(){this.ps.addRow(),this.recreateSvgControlPoints(),this.redraw()}addCol(){this.ps.addCol(),this.recreateSvgControlPoints(),this.redraw()}static load(e){return JSON.parse(e)}save(){return JSON.stringify(this.ps.points.map(t=>t.map(s=>[Math.floor(s.x),Math.floor(s.y)])))}recreateSvgControlPoints(){this.controlG.clear();for(let e=0;e<this.ps.points.length;e++){const t=this.ps.points[e];for(let s=0;s<t.length;s++){const o=t[s];o.i=e,o.j=s;const c=this.controlG.circle(10).fill("#337ecc").center(o.x,o.y);c.draggable().on("dragmove",l=>{o.x=l.detail.box.cx,o.y=l.detail.box.cy,this.redraw()}).on("mouseenter",()=>{c.fill("#f89898"),c.coordText=this.curveG.text(`[${o.i}, ${o.j}](${o.x.toFixed(0)}, ${o.y.toFixed(0)})`).move(o.x-10,o.y+20)}).on("mouseleave",()=>{var l;c.fill("#337ecc"),(l=c.coordText)==null||l.remove()})}}}meshDivide(e,t=2,s=t){let o=[];for(const c of e){const l=c.uvPoints[0].u,r=c.uvPoints[1].u,u=c.uvPoints[0].v,w=c.uvPoints[3].v,d=(r-l)/t,g=(w-u)/s;for(let v=0;v<s;v++)for(let f=0;f<t;f++)o.push(new U([new P(l+d*f,u+g*v),new P(l+d*f+d,u+g*v),new P(l+d*f+d,u+g*v+g),new P(l+d*f,u+g*v+g)]))}return o}bezierSurface(e){const{firstDivide:t,divide:s,showGrid:o,count:c}=this.param;let l=new Set([0,1]),r=new Set([0,1]);const u=f=>Math.round(f*1e3),w=f=>{for(const n of f)for(let x=0;x<4;x++)n.screenPoints[x]=ce(e,n.uvPoints[x]);return f},d=f=>{f.forEach(n=>{n.uvPoints.forEach(x=>{l.add(u(x.u)),r.add(u(x.v))})})},g=({meshes:f})=>{for(const n of f)(o.value||r.has(u(n.uvPoints[0].v)))&&this.curveG.line(n.screenPoints[0].x,n.screenPoints[0].y,n.screenPoints[1].x,n.screenPoints[1].y).stroke({color:"black"}),(o.value||l.has(u(n.uvPoints[1].u)))&&this.curveG.line(n.screenPoints[1].x,n.screenPoints[1].y,n.screenPoints[2].x,n.screenPoints[2].y).stroke({color:"black"}),(o.value||r.has(u(n.uvPoints[2].v)))&&this.curveG.line(n.screenPoints[2].x,n.screenPoints[2].y,n.screenPoints[3].x,n.screenPoints[3].y).stroke({color:"black"}),(o.value||l.has(u(n.uvPoints[3].u)))&&this.curveG.line(n.screenPoints[3].x,n.screenPoints[3].y,n.screenPoints[0].x,n.screenPoints[0].y).stroke({color:"black"})};this.anim.reset();let v=[new U([new P(0,0),new P(1,0),new P(1,1),new P(0,1)])];this.anim.addFrame({meshes:w(v)},g),v=this.meshDivide(v,t.row,t.col),d(v),this.anim.addFrame({meshes:w(v)},g);for(let f=1;f<c.value;f++)v=this.meshDivide(v,s.row,s.col),this.anim.addFrame({meshes:w(v)},g)}redraw(e=!1){this.bezierSurface(this.ps.points),e?this.anim.play():this.anim.plainDraw()}};const ue=a=>(ne("data-v-72d22308"),a=a(),ie(),a),de={class:"text-large font-600 mr-3"},he={class:"usage"},fe=ue(()=>D("svg",{id:"canvas",xmlns:"http://www.w3.org/2000/svg",version:"1.1",viewBox:"0 0 800 600",preserveAspectRatio:"xMidYMid meet"},null,-1)),me={__name:"BezierSurface",setup(a){const e=X(),t=M({row:3,col:3}),s=M({row:3,col:3}),o=C(!0),c=C(""),l=C(""),r=C(1);let u=null,w=null;const d=Z().query;if(d.firstDivide){const{row:m,col:p}=JSON.parse(d.firstDivide);t.row=m,t.col=p}if(d.divide){const{row:m,col:p}=JSON.parse(d.divide);s.row=m,s.col=p}d.showGrid&&(o.value=d.showGrid=="true"),d.points&&(w=O.load(d.points)),d.count&&(r.value=parseInt(d.count)),ee(()=>{u=new O("#canvas",{firstDivide:t,divide:s,showGrid:o,count:r},(m,p)=>{c.value=m,l.value=p},w)}),te([t,s,r,o],()=>{u.redraw()});const g=()=>{u.redraw(!0)},v=()=>{const m=u.save(),p=`${window.location.origin}/#/beziersf?firstDivide=${JSON.stringify(t)}&divide=${JSON.stringify(s)}&showGrid=${o.value}&points=${m}&count=${r.value}`;navigator.clipboard.writeText(p),oe({title:N.global.t("bezier.shareTitle"),message:N.global.t("bezier.shareDesc")})},f=()=>{u.addRow()},n=()=>{u.addCol()},x=()=>{e.push("/")};return(m,p)=>{const T=_("el-page-header"),E=_("el-header"),$=_("el-button"),V=_("el-form-item"),z=_("el-input-number"),I=_("el-text"),A=_("el-space"),q=_("el-checkbox"),Y=_("el-form"),H=_("el-aside"),K=_("el-alert"),L=_("el-main"),B=_("el-container");return R(),j(B,{style:{height:"100%"}},{default:h(()=>[i(E,null,{default:h(()=>[i(T,{onBack:x,style:{"padding-top":"10px"}},{content:h(()=>[D("span",de,y(m.$t("beziersf.title")),1)]),_:1})]),_:1}),i(B,{style:{height:"calc(100% - 40px)"}},{default:h(()=>[i(H,{width:"320px"},{default:h(()=>[i(Y,{"label-position":"left","label-width":"auto"},{default:h(()=>[i(V,{label:m.$t("beziersf.grid")},{default:h(()=>[i($,{onClick:f},{default:h(()=>[S(y(m.$t("beziersf.addRow")),1)]),_:1}),i($,{onClick:n},{default:h(()=>[S(y(m.$t("beziersf.addCol")),1)]),_:1})]),_:1},8,["label"]),i(V,{label:m.$t("beziersf.tessellation")},{default:h(()=>[i(z,{modelValue:r.value,"onUpdate:modelValue":p[0]||(p[0]=b=>r.value=b),min:1,max:4,"controls-position":"right"},null,8,["modelValue"])]),_:1},8,["label"]),i(V,{label:m.$t("beziersf.firstDivide")},{default:h(()=>[i(A,null,{default:h(()=>[i(z,{modelValue:t.row,"onUpdate:modelValue":p[1]||(p[1]=b=>t.row=b),min:2,max:5,"controls-position":"right"},null,8,["modelValue"]),i(I,null,{default:h(()=>[S("x")]),_:1}),i(z,{modelValue:t.col,"onUpdate:modelValue":p[2]||(p[2]=b=>t.col=b),min:2,max:5,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1},8,["label"]),i(V,{label:m.$t("beziersf.divide")},{default:h(()=>[i(A,null,{default:h(()=>[i(z,{modelValue:s.row,"onUpdate:modelValue":p[3]||(p[3]=b=>s.row=b),min:2,max:5,"controls-position":"right"},null,8,["modelValue"]),i(I,null,{default:h(()=>[S("x")]),_:1}),i(z,{modelValue:s.col,"onUpdate:modelValue":p[4]||(p[4]=b=>s.col=b),min:2,max:5,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1},8,["label"]),i(V,{label:m.$t("beziersf.showGrid")},{default:h(()=>[i(q,{modelValue:o.value,"onUpdate:modelValue":p[5]||(p[5]=b=>o.value=b)},null,8,["modelValue"])]),_:1},8,["label"]),i(V,null,{default:h(()=>[i($,{type:"primary",onClick:g},{default:h(()=>[S(y(m.$t("bezier.playAnim")),1)]),_:1}),i($,{onClick:v},{default:h(()=>[S(y(m.$t("bezier.share")),1)]),_:1})]),_:1})]),_:1}),D("p",he,[i(I,null,{default:h(()=>[D("strong",null,y(m.$t("bezier.usage")),1),S(y(m.$t("beziersf.usageDetail")),1)]),_:1})])]),_:1}),i(L,null,{default:h(()=>[c.value!==""?(R(),j(K,{key:0,class:"animateinfo",title:c.value,description:l.value,type:"success",closable:!1},null,8,["title","description"])):se("",!0),fe]),_:1})]),_:1})]),_:1})}}},_e=W(me,[["__scopeId","data-v-72d22308"]]);export{_e as default};
