import{S as J}from"./svg.draggable-CvVuDuZ7.js";import{i as P,_ as O,u as Y,r as g,o as j,w as X,a as p,b as y,c as x,d as m,e as h,f as z,t as _,g as $,h as q,E as H,p as K,j as Q}from"./index-DkC92dOa.js";class C{constructor(e,s){this.x=e,this.y=s}}function D(a){const e=[];for(let s=0;s<a.length;s++)e.push(new C(a[s].x,a[s].y));return e}class W{constructor(e,s){this.drawFn=e,this.param=s}run(){return this.drawFn(this.param)}}class Z{constructor(e,s){this.setAnimInfo=e,this.g=s,this.reset()}reset(){this.frames=[],this.n=0}seek(e){this.n=e,this.step()}step(){this.g.clear();const e=this.frames[this.n];if(e){const s=e.run();this.setAnimInfo(P.global.t("bezier.animateInfoTitle",[this.n+1,this.frames.length]),s),this.n+=1}}addFrame(e,s){this.frames.push(new W(s,e))}play(){this.seek(0);const e=4e3/this.frames.length,s=setInterval(()=>{if(this.n>=this.frames.length){clearInterval(s);return}this.step()},e)}plainDraw(){this.seek(this.frames.length-1),this.setAnimInfo("","")}}function I(a){let e=1;for(let s=2;s<=a;s++)e*=s;return e}function ee(a,e){return I(a)/(I(e)*I(a-e))}function S(a,e){return a===0&&e===0?1:Math.pow(a,e)}class A{constructor(e,s={algorithm,iters,tstep},t,l=[]){if(this.svg=J(e),this.curveG=this.svg.group(),this.anim=new Z(t,this.curveG),this.points=[],l.length>0)for(const o of l)this.addControlPoint(o[0],o[1]);else this.addControlPoint(100,100),this.addControlPoint(250,50),this.addControlPoint(400,100);this.param=s,this.redraw(),this.svg.on("dblclick",o=>{const i=this.svg.point(o.pageX,o.pageY);this.addControlPoint(i.x,i.y),this.redraw()})}static load(e){return JSON.parse(decodeURIComponent(e))}save(){return encodeURIComponent(JSON.stringify(this.points.map(e=>[Math.floor(e.x),Math.floor(e.y)])))}addControlPoint(e,s){const t=new C(e,s);this.points.push(t);const l=this.svg.circle(10).fill("#337ecc").center(t.x,t.y);l.draggable().on("dragmove",o=>{t.x=o.detail.box.cx,t.y=o.detail.box.cy,this.redraw()}).on("mouseenter",()=>{l.fill("#f89898"),l.coordText=this.curveG.text(`(${t.x.toFixed(0)}, ${t.y.toFixed(0)})`).move(t.x-10,t.y+20)}).on("mouseleave",()=>{var o;l.fill("#337ecc"),(o=l.coordText)==null||o.remove()})}drawCurve(e,s){for(let t=0;t<e.length;t++){const l=`P${t+1}`;this.curveG.text(l).move(e[t].x-10,e[t].y-30)}this.drawLines(s,{color:"black"})}drawLines(e,s){for(let t=1;t<e.length;t++){let l=e[t-1],o=e[t];this.curveG.line(l.x,l.y,o.x,o.y).stroke(s)}}bezierByFormula(e,s){this.anim.reset();const t=[],l=e.length-1;let o=0;function i(n){let u=new C(0,0);for(let c=0;c<=l;c++){const f=ee(l,c)*S(n,c)*S(1-n,l-c);u.x+=e[c].x*f,u.y+=e[c].y*f}return u}for(;o<=1;)t.push(i(o)),this.anim.addFrame({t:o,curvePoints:D(t)},n=>(this.drawCurve(e,n.curvePoints),`t = ${n.t.toFixed(2)}`)),o+=s;return Math.abs(o-s-1)>.001&&(o=1,t.push(i(o)),this.anim.addFrame({t:o,curvePoints:D(t)},n=>(this.drawCurve(e,n.curvePoints),`t = ${n.t.toFixed(2)}`))),t}doBezierDivide(e){const s=e.length-1,t=[],l=[],o=[];for(let n=0;n<=s;n++)o.push(new Array(s+1));function i(n,u){let c=o[n][u];if(c)return c;if(c=new C(0,0),u===0)c=e[n];else{const f=i(n,u-1),b=i(n+1,u-1);c.x=(f.x+b.x)/2,c.y=(f.y+b.y)/2}return o[n][u]=c,c}for(let n=0;n<=s;n++){const u=n;t.push(i(0,u))}for(let n=0;n<=s;n++){const u=s-n;l.push(i(n,u))}return[t,l]}bezierByDivide(e,s=1){this.anim.reset();let t=[e];function l(){const o=[t[0][0]];for(let i=0;i<t.length;i+=2)o.push(t[i+1][0]);return o.push(t[t.length-1][t[t.length-1].length-1]),o}for(let o=0;o<s;o++){let i=[];for(const n of t)i=i.concat(this.doBezierDivide(n));t=i,this.anim.addFrame({i:o,curvePoints:l(),controlPoints:t.flat()},n=>(this.drawCurve(e,n.curvePoints),this.drawLines(n.controlPoints,{color:"gray",dasharray:[3,3]}),P.global.t("bezier.curIters",[n.i+1])))}return l()}redraw(e=!1){this.param.algorithm.value==="formula"?this.bezierByFormula(this.points,this.param.tstep.value):this.bezierByDivide(this.points,this.param.iters.value),e?this.anim.play():this.anim.plainDraw()}}const te=a=>(K("data-v-1c510b92"),a=a(),Q(),a),se={class:"text-large font-600 mr-3"},oe={class:"usage"},ne=te(()=>z("svg",{id:"canvas",xmlns:"http://www.w3.org/2000/svg",version:"1.1",viewBox:"0 0 800 600",preserveAspectRatio:"xMidYMid meet"},null,-1)),le={__name:"Bezier",setup(a){const e=Y(),s=g("formula"),t=g(2),l=g(.1),o=g(""),i=g("");let n=null,u=[];new URLSearchParams(location.search).forEach((r,d)=>{d==="algorithm"?s.value=r:d==="tstep"?l.value=parseFloat(r):d==="iters"?t.value=parseInt(r):d==="points"&&(u=A.load(r))}),j(()=>{n=new A("#canvas",{algorithm:s,iters:t,tstep:l},(r,d)=>{o.value=r,i.value=d},u)}),X([s,t,l],()=>{n.redraw()});const c=()=>{n.redraw(!0)},f=()=>{const r=n.save(),d=`${window.location.origin}/bezier?algorithm=${s.value}&tstep=${l.value}&iters=${t.value}&points=${r}`;navigator.clipboard.writeText(d),H({title:P.global.t("bezier.shareTitle"),message:P.global.t("bezier.shareDesc")})},b=()=>{e.push("/")};return(r,d)=>{const N=p("el-page-header"),M=p("el-header"),B=p("el-option"),G=p("el-select"),w=p("el-form-item"),F=p("el-input-number"),V=p("el-button"),T=p("el-form"),U=p("el-text"),R=p("el-aside"),L=p("el-alert"),E=p("el-main"),k=p("el-container");return y(),x(k,{style:{height:"100%"}},{default:m(()=>[h(M,null,{default:m(()=>[h(N,{onBack:b,style:{"padding-top":"10px"}},{content:m(()=>[z("span",se,_(r.$t("bezier.title")),1)]),_:1})]),_:1}),h(k,{style:{height:"calc(100% - 40px)"}},{default:m(()=>[h(R,{width:"240px"},{default:m(()=>[h(T,{"label-position":"left","label-width":"auto"},{default:m(()=>[h(w,{label:r.$t("bezier.algorithm")},{default:m(()=>[h(G,{modelValue:s.value,"onUpdate:modelValue":d[0]||(d[0]=v=>s.value=v),style:{width:"150px"}},{default:m(()=>[h(B,{label:r.$t("bezier.byFormula"),value:"formula"},null,8,["label"]),h(B,{label:r.$t("bezier.byDeC"),value:"DeC"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["label"]),s.value=="formula"?(y(),x(w,{key:0,label:r.$t("bezier.tStep")},{default:m(()=>[h(F,{modelValue:l.value,"onUpdate:modelValue":d[1]||(d[1]=v=>l.value=v),min:.01,max:.5,step:.01,precision:2},null,8,["modelValue"])]),_:1},8,["label"])):(y(),x(w,{key:1,label:r.$t("bezier.iterNum")},{default:m(()=>[h(F,{modelValue:t.value,"onUpdate:modelValue":d[2]||(d[2]=v=>t.value=v),min:1,max:10},null,8,["modelValue"])]),_:1},8,["label"])),h(w,null,{default:m(()=>[h(V,{type:"primary",onClick:c},{default:m(()=>[$(_(r.$t("bezier.playAnim")),1)]),_:1}),h(V,{onClick:f},{default:m(()=>[$(_(r.$t("bezier.share")),1)]),_:1})]),_:1})]),_:1}),z("p",oe,[h(U,null,{default:m(()=>[z("strong",null,_(r.$t("bezier.usage")),1),$(_(r.$t("bezier.usageDetail")),1)]),_:1})])]),_:1}),h(E,null,{default:m(()=>[o.value!==""?(y(),x(L,{key:0,class:"animateinfo",title:o.value,description:i.value,type:"success",closable:!1},null,8,["title","description"])):q("",!0),ne]),_:1})]),_:1})]),_:1})}}},re=O(le,[["__scopeId","data-v-1c510b92"]]);export{re as default};
